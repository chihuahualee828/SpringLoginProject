<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta th:name="_csrf.parameterName" th:content="${_csrf.token}" />
<title>設定</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>

.container {
  position: relative;
  width: 50%;
  margin: 0 auto;
  margin-top: 50px;
  border-radius: 10px;
  background-color: #f2f2f2;
  padding: 10px 0 40px 0;
} 
</style>
<body>

	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		  <div class="container-fluid">
	    <a class="navbar-brand" href="/demo1" th:text="${#authentication.getPrincipal().getDisplayName()}">Home</a>
	    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	      <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navbar-collapse" id="navbarSupportedContent">
	      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
	        <li class="nav-item">
	          <a class="nav-link" href="/demo1">Index</a>
	        </li>
	        <li class="nav-item">
	          <a class="nav-link" href="view" >View</a>
	        </li>
	        <li class="nav-item">
	          <a class="nav-link" href="register_page">Create</a>
	        </li>
	        <li class="nav-item" sec:authorize="hasAnyAuthority('ADMIN')">
	          <a class="nav-link" href="h2-console">H2</a>
	        </li>
	        <li class="nav-item active" sec:authorize="hasAnyAuthority('ADMIN')">
	          <a class="nav-link active" aria-current="page">Settings</a>
	        </li>
	      </ul>
	      <div class="d-flex">
			<button type="button" onclick="logout()" style="border-radius: 8px;" class="btn btn-outline-success">Logout</button>
			<form id="logoutForm" method="post" action="perform_logout">
	        	<input type="hidden"  th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	        </form>
          </div>
	      
	    </div>
	  </div>
	</nav>
	
    <div class="container">
    <h2 style="text-align:center;">Settings</h2>
    <form style="margin: auto; width: 220px;">
        
        
        
        <p>
         Email       
        	<input type="text" th:value="${email.email}" id="email" required/>
        </p>
        <p>
         App Password
            <input type="text" th:value="${email.password}" id="password" required/>
        </p>
        
        <input type="hidden"  th:name="${_csrf.parameterName}"  th:value="${_csrf.token}" />
        <button onclick="send()">Save</button>
    </form>
    </div>
</body>


<script type="text/javascript"
        src="/demo1/webjars/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" ></script>
<script type="text/javascript">

	function logout() {
		if(confirm("Sure you want to log out?")){
			var form = document.getElementById('logoutForm');
			form.submit();
		}else{
			return false;
		}
		//location.href = "logout_page";// logout_page : see controller
		
		
	}
	
	function send() {
	    var email = document.getElementById("email").value;
	    var password = document.getElementById("password").value;

	    var token = $("meta[name='_csrf.parameterName']").attr("content");
		$.ajaxSetup({
	        beforeSend: function(xhr) {
	            xhr.setRequestHeader('X-CSRF-Token', token);
	        }
	    });
	    $.ajax({
			type: "POST",
			url: '/demo1/mail-config',
			contentType: "application/json",
		    data: JSON.stringify({
		    	"email": email,
		    	"password": password
		    }),
		    
		    success:function(data) {
				console.log("success: " + JSON.stringify(data));
			},
			error:function(data) {
				console.log("error: " + JSON.stringify(data));
			}
		});
	    
	    
	}
	
	
</script>
</html>